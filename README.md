# Circular Strip Packing Problem
Project for course Geometric Algorithms on Faculty of Mathematics, University of Belgrade 

## Acknowledgments

This project makes use of the **Nonlinear Equation System Solver** developed by Tom Willow. A huge thanks for creating such a useful yet simple tool!

You can find the original project here: [https://github.com/tomwillow/tomsolver](https://github.com/tomwillow/tomsolver).



# Algoritam baziran na heuristici za problem 2D pakovanja krugova u pravougaonik

Na pravougaonik je dimenzija W x L*, gde je W fiksirana sirina, a L* duzina. Imamo N krugova proizvoljnih poluprecnika. Cilj je da krugove rasporedimo u pravougaonik tako pakovanje bude sto gusce, a da se odrze osnovne invarijante - da se krugovi ne seku medjusobno, i da krugovi ne seku ni jednu stranicu pravougaonika, Zadatak nam je da minimizujemo L, a spakujemo sve krugove.

Uglovi se pakuju tako da uvek dodiruju dve stvari - bilo dve ivice, ivicu i krug ili dva kruga. Te pozicije se nazivaju ugaone pozicije. Racunanje svih tih pozicija verovatno je bila i naizazovnija stvar za mene u ovom radu, jer nigde nije navedeno kako se tacno racunaju, a ni na internetu nisam nasao utehu, posebno za slucajev tj. pozicije kad su "poluprave" naseg ugla dva kruga ili krug i jedna od ivica pravougaonika. Za nalazenje pozicije gde ce lezati centar kruga koji dodiruje dva druga kruga, koristio sam tomsolver, jednostavan solver za resavanje sistema nelinearnih jednacina. Ovaj solver nam daje koordinate centra jednog kruga (iako mogu postojati i dva ovakva kruga) pa centar drugog kruga dobijamo refleksijom na pravu koja prolazi kroz centre dva kruga koja posmatramo. Za slucaj kada ugaona pozicija dodiruje krug i stranicu, dovoljno je koriscenje pitagorine teoreme. Dalje, glavni algoritam koij je opisan u radu koristi odvojenu zracnu pretragu sa strategijom restarovanja i pogledom unapred. (separate beam search with restart strategy and look ahead), koja je implementirana kao breadth first search. Sama zracna pretraga je jako slicna best first search pretrazi, samo sto se umesto obilaska jednog najboljeg cvora na nivou, obilazi w najboljih . Obicna zracna pretraga na svakom nivou stabla ispituje maksimalno w cvorova, Ona racuna kvalitet svih cvorova i bira najbolje, a potom ih sve obilazi. U ovom radu koristi se odvojena zracna pretraga, tako sto se za prvi nivo bira proizvoljan krug koji se postavlja u donji levi ugao. Potom racunaju se ugaone pozicije na kojima se potencijalno mogu naci deca cvorovi. Zatim se za sve ostale krugove koji nisu postavljeni racunaju ugaone pozicije i njihov kvalitet (koji se meri merom MLDP - Minimum Local Distance Position). Ona se racuna tako sto od potencijalnog kruga, koga privremeno postavimo na ugaonu poziciju, racunaju rastojanja do svih ostalih krugova i ivica i uzima se najmanje. U ovom racunanju preskacemo rastojanje od dve poluprave koje cine nas "ugao" jer one dodiruju nas krug i rastojanje do njih je 0. Primetimo da jos neki entitet (bilo stranica ili ugao) dodiruju nas krug, ova mera ce opet biti 0, sto je i logicno, a i pozeljno (Zato se cesto mali krug cusne bas izmedju 3 velika kruga, i maksimalno se iskoristi prostor. Nakon racunanja ove mera za sve pozicije potencijalnih dece cvorova ili krugova, bira se w pozicija (kojima su pridruzeni konkretni krugovi), i izvodi se sledece: Za najbolji krug, pokrece se beam search sa sirinom zraka 1, za drugi najbolji se pokrece pretraga za sirinom 2, za w-ti najobji se pokrece pretraga sirine w. Ovo odgovara ideji da je za kvalitetnije pozicije potrebno manje siriti pretragu, dok za malo losije odgovara nesto sira pretraga. Svaka od ovih pretra pokrece se par puta (strategija restartovanja), i menja se pocetni krug, u cilju bezanja iz lokalnog optimuma. Za lookahead se koristi pohlepni algoritam koji uvek bira poziciju sa najmanjim MLDP-om, u cilju provere da li u trenutni pravougaonik, kada mu fiksiramo duzinu, mozemo smestiti sve preostale krugove. Ako mozemo, pamtimo resenje i pokrecemo pohlepnu pretragu za manje L. Ako ne uspemo da dodjemo do resenja, a uradili smo look ahead za sve (ili deo potencijalnih ugaonih pozicija - koji procenat potencijalnih cvorova proveravamo lookaheadom - odredjuj parametar koji mi zadajemo). Ako isproveravamo sve zeljene pozicije i ni jedna ne vodi do uspesnog pakovanja, onda povecavamo L. Ja nisam uspeo da implementiram ceo algoritam, imao sam problema sa razumevanjem pojedinih delova rada, kao sto je algoritam 4, ondnosno spoj svega navedenog u konacni algoritam. Prvi pristup mi je bio da postoje pokazivaci na date krugove, koji se jednom definisu, prilikom generisanja krugova, a posle se njima manipulise. Na primer, kada dodjemo do lookaheada, tada dodajemo jedan po jedan krug u pohlepnoj pretrazi, tada iz skupa nepostavljenih krugova premestamo te pokazivace u skup postavljenih. Uvek iscrtavajuci oba skupa u svakom trenutku. Nakon toga, moramo skinuti sve cvorove koje smo prethodno dodali (mozemo npr napraviti kopiju na pocetku pohlepne pretrage i na kraju vrati ova dva skupa u prethodno stanje). Problem je bila pretraga u sirinu, gde je svaki od w cvorova definisan svojim stanjem postavljenih i nepostavljenih skupova - svaki je razliciti najverovatnije razliciti, pa nam za obradjivanje svakog cvora treba njegova vlastita konfiguracija - skup postavljenih i nepostavljenih krugova. Zato sam se odlucio da svaki cvor unutar sebe ima ova dva skupa, ovo je zahtevalo drasticnu izmenu projekta. Na kraju je rezultat mog rada je simpaticna animacija koja sasvim solidno rasporedjuje krugove, ali da sam implementirao ceo algoritam, sigurno bi rezultati bili jos bolji. Za sada koristi lookahead sa drugog nivoa. Napisao sam i funkciju BeamSearcha gde bi varirali duzinu pravougaonika u zavisnosti od uspesnosti lookaheada, koja je poprilicno jednostavna. Izostalo je pokretanje algoritma za odvojene zracne pretrage, tj pokretanje vise pretraga za razlicite vredmosti w, kao i strategija restartovanja. Takodje neki problemi koje donosi celobrojna aritmetika u geometriji (npr. zaokruzivanje udaljenosti izmedju krugova moze dovesti do netacnih izracunavanja rastojanja. U tim situacijama, dozvoljen je blagi, skoro neprimetni presek elemenata. Takodje, obrnutost koordinatno sistema je lako resena dodavanje funkcija koje invertuju top i bottom. 
